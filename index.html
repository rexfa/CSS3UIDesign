<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/css/variables.css">
    <link rel="stylesheet" href="assets/css/nativize.css">
    <link rel="stylesheet" href="assets/css/global.css">
    <link rel="stylesheet" href="assets/css/about.css">
    <link rel="stylesheet" href="assets/css/nav.css">
    <link rel="stylesheet" href="assets/css/section.css">
    <link rel="stylesheet" href="assets/css/demo.css">
    <link rel="stylesheet" href="assets/css/github.css">
    <link rel="stylesheet" href="assets/css/jobs.css">
    <link rel="stylesheet" href="assets/css/jobs-status.css">
    <link rel="stylesheet" href="assets/css/history.css">
    <link rel="stylesheet" href="assets/css/app-sys-information.css">
    <link rel="stylesheet" href="assets/css/sys-settings.css">
    <link rel="stylesheet" href="assets/css/logs.css">

    <link rel="import" href="sections/about.html">
    <link rel="import" href="sections/jobs/jobs.html">
    <link rel="import" href="sections/jobs/jobs-status.html">
    <link rel="import" href="sections/logs/history.html">
    <link rel="import" href="sections/logs/logs.html">
    <link rel="import" href="sections/communication/apply-for-service.html">
    <link rel="import" href="sections/system/app-sys-information.html">
    <link rel="import" href="sections/system/settings.html">


</head>

<body>
    <nav class="nav js-nav">
        <header class="nav-header">
            <h1 class="nav-title">R <strong>Design</strong></h1>
            <svg class="nav-header-icon">
                <use xlink:href="assets/img/dna.svg"></use>
            </svg>
        </header>

        <div class="nav-item u-category-jobs">
            <h5 class="nav-category">
                <svg class="nav-icon">
                    <use xlink:href="assets/img/icons.svg#icon-windows"></use>
                </svg>任务
            </h5>
            <button type="button" id="button-jobs" data-section="jobs" class="nav-button">任务<em>列表</em></button>
            <button type="button" id="button-jobs-status" data-section="jobs-status" class="nav-button">平台运行<em>状态</em></button>
        </div>

        <div class="nav-item u-category-menu">
            <h5 class="nav-category">
                <svg class="nav-icon">
                    <use xlink:href="assets/img/icons.svg#icon-menu"></use>
                </svg> 历史结果
            </h5>
            <button type="button" id="button-history" data-section="history" class="nav-button">查看<em>任务结果</em>
            </button>
            <button type="button" id="button-logs" data-section="logs" class="nav-button">查看<em>任务日志</em></button>
        </div>
        <div class="nav-item u-category-communication">
            <h5 class="nav-category">
                <svg class="nav-icon">
                    <use xlink:href="assets/img/icons.svg#icon-communication"></use>
                </svg> 通信
            </h5>
            <button type="button" id="button-apply-for-service" data-section="apply-for-service" class="nav-button">申请<em>服务</em></button>
        </div>

        <div class="nav-item u-category-system">
            <h5 class="nav-category">
                <svg class="nav-icon">
                    <use xlink:href="assets/img/icons.svg#icon-system"></use>
                </svg> 系统
            </h5>
            <button type="button" id="button-app-sys-information" data-section="app-sys-information" class="nav-button">显示<em>系统信息</em></button>
            <button type="button" id="button-settings" data-section="settings" class="nav-button">平台<em>设置</em></button>
        </div>

        <footer class="nav-footer">
            <button type="button" id="button-about" data-modal="about" class="nav-footer-button">关于</button>
            <a class="nav-footer-logo" href="https://www.rexfa.cc" aria-label="作者主页">
                <svg class="nav-footer-icon">
                    <use xlink:href="assets/img/icons.svg#icon-love"></use>
                </svg>
            </a>
        </footer>
    </nav>

    <main class="content js-content"></main>
    <script src="./assets/renderer-lib/chart-min.js"></script>
    <script>
        require('./assets/imports')
        require('./assets/ex-links')
        require('./assets/nav')
        require('./assets/demo-btns')
        require('./assets/code-blocks')
        require('./assets/normalize-shortcuts')



        function jobsTest() {
            let ramboName = (+new Date).toString(36)
            addJobInfoPanel(ramboName)
        }
        //引用模板
        function importJobInfoTemplate() {
            let template = document.getElementsByClassName("jobstemplate")
            let clone = template[0].children[0].cloneNode(true)
            setTTTime(clone)
            let workspace = document.getElementsByClassName('jobs-workspace-wrapper')
            workspace[0].appendChild(clone)
        }
        //获取所有的panel
        function getAllJobInfoPanel() {
            let jobs = document.getElementsByClassName('jobs-workspace-wrapper')[0].getElementsByClassName("taskpanel");
            return jobs;
        }
        //获取指定name的panel
        function getJobInfoPanelByJobName(jobName) {
            let job = document.getElementById("taskpanel" + jobName);
            return job;
        }
        //创建一个工作面板
        function addJobInfoPanel(jobName) {
            let template = document.getElementsByClassName("jobstemplate");
            let clone = template[0].children[0].cloneNode(true);
            clone.setAttribute("id", "taskpanel" + jobName);

            setCloneDomContent(clone, "task-name", "taskname" + jobName, jobName);
            setCloneDomContent(clone, "task-operation", "taskoperation" + jobName, "准备完毕");
            setCloneDomContent(clone, "task-status", "taskstatus" + jobName, "准备");
            setCloneDomContent(clone, "task-scale", "taskscale" + jobName, "10G");
            let btnOperation = clone.getElementsByClassName("job-operation")[0];
            btnOperation.setAttribute("onclick", "operationonclick('" + jobName + "')");
            let btnSelectScript = clone.getElementsByClassName("select-script")[0];
            btnSelectScript.setAttribute("onclick", "selectscriptonclick('" + jobName + "')");
            let controlpanel = clone.getElementsByClassName("controlpanel-hidden")[0];
            controlpanel.setAttribute("id", "controlpanel" + jobName);
            let taskinfopanel = clone.getElementsByClassName("taskinfopanel")[0];
            taskinfopanel.setAttribute("id", "taskinfopanel" + jobName);
            let taskhr = clone.getElementsByClassName("task-hr")[0];
            taskhr.setAttribute("id", "taskhr" + jobName);
            setJITTime(clone);
            setJTTTime(clone);
            document.getElementsByClassName('jobs-workspace-wrapper')[0].appendChild(clone);
        }

        function setCloneDomContent(cloneNode, className, domId, content) {
            let target = cloneNode.getElementsByClassName(className)[0];
            let dom = document.createElement('em');
            dom.innerHTML = content;
            dom.id = domId;
            var child = document.getElementById(domId);
            if (null != child) {
                target.removeChild(child);
            }
            target.appendChild(dom);
        }

        function setDomContent(domId, content) {
            var dom = document.getElementById(domId);
            dom.innerHTML = content;
        }

        function setJTTTime(jobInfoNode) {
            let tt = jobInfoNode.getElementsByClassName("task-runtime")[0];
            let dom = document.createElement('em');
            //dom.className='book';
            dom.innerHTML = CurentTime();
            tt.appendChild(dom);
        }

        function setJITTime(jobInfoNode) {
            let tt = jobInfoNode.getElementsByClassName("task-inputtime")[0];
            let dom = document.createElement('em');
            //dom.className='book';
            dom.innerHTML = CurentTime();
            tt.appendChild(dom);
        }

        function CurentTime() {
            var now = new Date();
            var year = now.getFullYear(); //年
            var month = now.getMonth() + 1; //月
            var day = now.getDate(); //日
            var hh = now.getHours(); //时
            var mm = now.getMinutes(); //分

            var clock = year + "-";
            if (month < 10)
                clock += "0";
            clock += month + "-";
            if (day < 10)
                clock += "0";
            clock += day + " ";
            if (hh < 10)
                clock += "0";
            clock += hh + ":";
            if (mm < 10) clock += '0';
            clock += mm;
            return (clock);
        }
        /* 添加动画用 */
        function operationonclick(jobName) {
            var controlpanelID = "controlpanel" + jobName;
            var controlpanel = document.getElementById(controlpanelID);
            var taskpanelID = "taskpanel" + jobName;
            var taskpanel = document.getElementById(taskpanelID);
            var taskinfopanelID = "taskinfopanel" + jobName;
            var taskinfopanel = document.getElementById(taskinfopanelID);
            var taskhrID = "taskhr" + jobName;
            var taskhr = document.getElementById(taskhrID);
            //var infopanel = 
            if (controlpanel.className == "controlpanel-hidden") {
                //taskpanel.style.height = 350;
                controlpanel.className = "controlpanel-display";
                taskinfopanel.classList.add("hidden");
                taskhr.classList.add("hidden");

            } else {
                controlpanel.className = "controlpanel-hidden";
                //taskpanel.style.height = 200;
                taskinfopanel.classList.remove("hidden");
                taskhr.classList.remove("hidden");
            }
        }
        /* 显示选择脚本 */
        function selectscriptonclick(jobName) {
            var scriptselector = document.getElementsByClassName("jobscripttemplate")[0];
            scriptselector.classList.remove("hidden");
            let btnSelectScriptSave = document.getElementsByClassName("jobscriptsave-button")[0];
            btnSelectScriptSave.setAttribute("onclick", "selectscriptsaveonclick('" + jobName + "')");
            setCloneDomContent(scriptselector, "script-jobname", "script-jobname", jobName);
        }
        /*保存选择脚本，让选择界面消失 */
        function selectscriptsaveonclick(jobName) {
            var scriptselector = document.getElementsByClassName("jobscripttemplate")[0];
            scriptselector.classList.add("hidden");
            var jobscriptradio = document.getElementsByName("jobscriptradio");
            for (i = 0; i < jobscriptradio.length; i++) {
                if (jobscriptradio[i].checked) {
                    setDomContent("taskoperation" + jobName, jobscriptradio[i].value);
                }
            }


        }
        /* chart的实验*/
        require('./assets/renderer-lib/chart-min');
        require('./assets/renderer-lib/chart-utils');
        require('./renderer-process/jobs/jobs-status');


        //测试获取本地工作目录列表
        const {
            ipcRenderer
        } = require('electron');
        /* 暂时不需要用主进程和渲染进程通讯
                const getjobsdataBtn = document.getElementById('btn-getjobsdata')

                getjobsdataBtn.addEventListener('click', () => {
                    ipcRenderer.send('asy-message-loadjobs', 'ping')
                });

                ipcRenderer.on('asy-message-loadjobs-reply', (event, arg) => {
                    //const message = `Asynchronous message reply: ${arg}`
                    //document.getElementById('async-reply').innerHTML = message
                    for (var key in arg) {
                        console.log(arg[key]);
                        let j = getJobInfoPanelByJobName(arg[key]);
                        if (!j) {
                            addJobInfoPanel(arg[key]);
                        }
                    }
                });
        */
    </script>
</body>

</html>